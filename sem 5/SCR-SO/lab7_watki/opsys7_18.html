<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SCR Systemy Operacyjne - zadanie na pracownie</title>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-2">
<meta http-equiv="Refresh" content="3600">
<script type="text/javascript" src="http://ff.kis.v2.scr.kaspersky-labs.com/1C15FB7F-4483-384F-882D-5D87625C668F/main.js" charset="UTF-8"></script></head>
<body>

<!--  -*- mode: TeX; fill-column: 75; coding: iso-8859-2-unix -*- -->
<p/>

<p/>

(15 punktów) Zadanie koncentruje siê wokó³ problemu producenta i konsumenta, który jest znany równie¿ pod nazw± problemu ograniczonego bufora (bounded buffer problem). Jeden lub wiêcej producentów (w±tków lub procesów) wytwarza elementy (dane), które s± przetwarzane przez jednego lub wiêcej konsumentów (w±tków lub procesów). Elementy s± przesy³ane pomiêdzy producentami i konsumentami z wykorzystaniem jakie¶ formy komunikacji miêdzyprocesowej.
<p/>

W zadaniu bêd± wykorzystane programy pochodz±ce z podrêcznika W.R. Stevensa &#132;UNIX. Programowanie us³ug sieciowych. Tom 2 - Komunikacja miêdzyprocesowa&#148; które mo¿na ¶ci±gn±æ ze strony: <a href="http://www.kohala.com/start/unpv22e/unpv22e.html">http://www.kohala.com/start/unpv22e/unpv22e.html</a>
<p/>

Wykonaj polecenia i odpowiedz na pytania zawarte w poni¿szym tek¶cie.
W raporcie z wykonania zadania wpisz jedynie odpowiedzi na pytania,
przy których jest zaznaczone, ¿e odpowied¼ powinna byæ zawarta w raporcie.
Pozosta³e pytania maj± charakter pomocniczy, ich celem jest zwrócenie
uwagi na istotne kwestie i pomoc w zrozumieniu przytoczonych programów.
Prowadz±cy mo¿e wymagaæ ustnej odpowiedzi na te pytania przy
sprawdzaniu zadania.
<p/>

<p/>

<ol>
<p/>

<p/>

<li> Budowanie programów
<ul>
<li> ¦ci±gnij za pomoca programu <tt>wget</tt> plik <a href="http://www.kohala.com/start/unpv22e/unpv22e.tar.gz">http://www.kohala.com/start/unpv22e/unpv22e.tar.gz</a> do lokalnego katalogu i rozpakuj go za pomoca <tt>gunzip</tt> i <tt>tar</tt>.
<li> Wejd¼ do rozpakowanego katalogu i uruchom <tt>./configure</tt>
<li> Je¿eli pracujesz na Linuksie otwórz plik <tt>config.h</tt> i usuñ nastepujace wiersze:
<pre>
#define uint8_t unsigned char     /* &lt;sys/types.h&gt; */
#define uint16_t unsigned short   /* &lt;sys/types.h&gt; */
#define uint32_t unsigned int     /* &lt;sys/types.h&gt; */
</pre>
<li> Wejd¼ do katalogu <tt>lib</tt> i wykonaj <tt>make</tt>.
<li> Wejd¼ do katalogu <tt>mutex</tt> i wykonaj <tt>make</tt>.<br/>
      Programy prodcons*.c zawarte w tym katalogu s± przedmiotem
      niniejszego zadania.
</ul>
<p/>

<p/>

<li> Prodcons1
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons1.c</tt>.
<li> Odpowiedz na poni¿sze pytania (tylko ustnie):
  <ul>
  <li> W której zmiennej przechowywana jest liczba producentów?
  <li> W jaki sposób producenci wype³niaj± tablice <tt>shared.buff</tt>?
  <li> Kiedy tablica <tt>shared.buff</tt> jest wype³niona prawid³owo?
  <li> Jaka funkcja jest odpowiedzialna za tworzenie nowych w±tków (+ wyja¶nij jej argumenty)?
  <li> Do czego s³u¿± i w jaki sposób s± modyfikowane zmienne <tt>shared.nput</tt> i <tt>shared.nval</tt>?
  <li> Która funkcja realizuje producentów, a która konsumenta?
  <li> Za co s± odpowiedzialne funkcje <tt>Set_concurrency</tt> i <tt>Pthread_join</tt> (+ wyja¶nij ich argumenty)?
  </ul>
<li> Uruchom program <tt>prodcons1</tt> z parametrami <tt>nitems</tt> i <tt>nthreads</tt> np. równymi odpowiednio 3000 i 5 (<tt>./prodcons1 3000 5 | less</tt>).<br/>
Za którym¶ razem na ekranie pojawi± siê komunikaty podobne do poni¿szych:
<pre>
count[0] = 2632  
count[1] = 984   
count[2] = 233   
count[3] = 648   
count[4] = 509   
buff[1679] = 1657
buff[1680] = 1657
buff[1681] = 1658
buff[1682] = 1659
buff[1683] = 1660
</pre>
Odpowiedz w raporcie:<br/>
Co mo¿e byæ powodem tego, ¿e suma warto¶ci komórek tablicy <tt>count</tt>, na powy¿szym przyk³adzie, przekracza warto¶æ <tt>nitems</tt> (inaczej: dlaczego liczba cykli pracy poszczególnych producentów przekracza liczbê wytwarzanych produktów)?
</ul>
<!--  Zadania dodatkowe: -->
<!--  1. (³atwe) Dodaj w programie sprawdzenie zgodno¶ci sumy jednostek -->
<!--     wyprodukowanych przez poszczególnych producentów z zadan± ilo¶ci±, i -->
<!--     na samym koñcu programu komunikat informuj±cy czy siê zgadzaj±. -->
<!--  2. (a - ³atwe) W kodzie konsumenta zamieñ komunikaty informuj±ce o -->
<!--     niezgodno¶ci poszczególnych pozycji tablicy buff na obliczanie liczby -->
<!--     pozycji z warto¶ci± wy¿sz± od indeksu i ni¿sz± od indeksu, i -->
<!--     wy¶wietlenie tylko tych warto¶ci. -->
<!--     (b - ³atwe) Wykonaj seriê eksperymentów z ró¿nymi warto¶ciami nitems -->
<!--     zarówno na diablo jak i na panamincie.  Opisz uzyskane niezgodno¶ci. -->
<!--     (c - trudne) Spróbuj wyja¶niæ w jaki sposób one powsta³y. -->
<!--     Podpowied¼: w eksperymentach pojawiaj± siê zarówno warto¶ci wy¿sze -->
<!--     jak i ni¿sze od warto¶ci indeksu, i to zarówno przy sumie jednostek -->
<!--     wyprodukowanych przez poszczególnych producentów równej jak i ró¿nej -->
<!--     od nitems -->
<!--  3. (a) W kodzie producenta, pomiêdzy &#132;produkcj±&#148; a zwiêkszaniem -->
<!--     liczników, dodaj instrukcjê nanosleep zawieszaj±c± w±tek na pewien -->
<!--     czas.  Dodaj ten czas wyra¿ony w mikrosekundach jako trzeci argument -->
<!--     wywo³ania programu.  Przeprowad¼ seriê eksperymentów na diablo i -->
<!--     panamincie ¿eby ustaliæ jaki efekt na wyniki produkcji ma to opó¼nienie. -->
<!--     Podpowied¼: wydaje mi siê, ¿e przy dostatecznie du¿ych czasach w±tki -->
<!--     producentów powinny produkowaæ równomiernie, a niezgodno¶ci produkcji -->
<!--     powinny byæ pewne (bez opó¼nienia mog³y one pojawiaæ siê lub nie). -->
<!--     Jednak co znaczy &#132;dostatecznie du¿y czas&#148; zale¿y pewnie od systemu. -->
<!--     (b) Przesuñ instrukcjê opó¼nienia nanosleep dalej, za instrukcje -->
<!--     inkrementacji zmiennych globalnych.  Powtórz eksperymenty i ponownie -->
<!--     spróbuj wyja¶niæ uzyskane wyniki. -->
<!--     Podpowied¼: wydaje mi siê, ¿e przy dostatecznie du¿ych czasach -->
<!--     opó¼nienia niezgodno¶ci powinny pojawiaæ siê rzadko, ale jednak bêd±. -->
<!--     W±tki producentów powinny produkowaæ równomiernie. -->
<p/>

<li> Prodcons2
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons2.c</tt>.
<li> Odpowiedz na poni¿sze pytania (tylko ustnie):
  <ul>
  <li> Ilu producentów mo¿e jednocze¶nie operowaæ na polach <tt>shared.buff</tt>, <tt>shared.nput</tt>, <tt>shared.nval</tt>?
  <li> Która zmienna i jakiego typu jest u¿ywana do synchronizacji dzia³añ producentów?
  <li> Do czego s³u¿± i jaki wp³yw na dzia³anie funkcji <tt>produce</tt> maj± funkcje <tt>Pthread_mutex_lock</tt> i <tt>Pthread_mutex_unlock</tt> (+ wyja¶nij argumenty)?
  <li> Jak dzia³a synchronizacja za pomoc± mutexu?
  <li> Co jest efektem nastêpuj±cej inicjalizacji w deklaracji zmiennej <tt>shared</tt>:
  <pre>
  shared =  PTHREAD_MUTEX_INITIALIZER ;
  </pre>
  <li> Co zyska³ program dziêki wprowadzeniu synchronizacji?
  </ul>
<li> Uruchom program <tt>prodcons2</tt> z parametrami <tt>nitems</tt> i <tt>nthreads</tt> np. równymi odpowiednio 3000 i 8 (<tt>./prodcons2 3000 8 | less</tt>). 
<p/>

Odpowiedz w raporcie:<br/>
Czy w serii eksperymentów pojawi³ siê wynik, taki ¿e suma warto¶ci komórek tablicy <tt>count</tt>, jest ró¿na od warto¶ci <tt>nitems</tt>?<br/>
Wyja¶nij poczynione obserwacje.
</ul>
<p/>

<p/>

<li> Prodcons3
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons3.c</tt>.
<li> Przeprowad¼ szczegó³ow± analizê dzia³ania funkcji <tt>consume_wait</tt> i wyja¶nij jej rolê w funkcji <tt>consume</tt> (tylko ustnie).
<li> Odpowiedz na poni¿sze pytania (tylko ustnie):
  <ul>
  <li> Kiedy konsument mo¿e sprawdzaæ elementy tablicy <tt>shared.buff</tt>?
  <li> Jak dzia³a funkcja <tt>times</tt>?<br/>
        W jakich jednostkach zlicza ona czas wykorzystania procesora i jak mo¿na przeliczyæ go na sekundy? (<tt>man -s 2 times</tt>)
  </ul>
<li> Zmodyfikuj programy <tt>prodcons2</tt> i <tt>prodcons3</tt> tak by umo¿liwiaæ wyznaczenie czasu wykonywania siê obu programów.  U¿yj w tym celu funkcji <tt>times</tt> (mo¿na pos³u¿yæ siê przyk³adem zamieszczonym na stronie <a href="http://www.opengroup.org/onlinepubs/009695399/functions/times.html">http://www.opengroup.org/onlinepubs/009695399/functions/times.html</a>)
<p/>
	
Odpowiedz w raporcie:<br/>
Uruchom kilka razy zmodyfikowane programy <tt>prodcons2</tt> i <tt>prodcons3</tt> z identycznymi parametrami <tt>nitems</tt> i <tt>nthreads</tt> np. równymi odpowiednio 300000 i 8.<br/>
Wyja¶nij poczynione obserwacje.
</ul>
<p/>

<p/>

<li> Prodcons4
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons4.c</tt>.
<li> Zmodyfikuj program <tt>prodcons4</tt> by umo¿liwiaæ wyznaczenie czasu wykonywania siê obu programów (tak jak <tt>prodcons2</tt> i <tt>prodcons3</tt> w poprzednim zadaniu).
<p/>
	
Odpowiedz w raporcie:<br/>
Uruchom kilka razy zmodyfikowane programy <tt>prodcons3</tt> i <tt>prodcons4</tt> z identycznymi parametrami <tt>nitems</tt> i <tt>nthreads</tt> np. równymi odpowiednio 300000 i 8.<br/>
Wyja¶nij poczynione obserwacje.
<li> Przeczytaj opis funkcji <tt>sched_yield</tt> i wyja¶nij do czego s³u¿y i jak dzia³a (tylko ustnie).
<li> Przeczytaj opis biblioteki rozszerzeñ czasu rzeczywistego <tt>librt</tt> i wyja¶nij do czego s³u¿y (tylko ustnie).
</ul>
<p/>

<p/>

<li> Prodcons5
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons5.c</tt>.
<li> Odpowiedz na poni¿sze pytania (tylko ustnie):
  <ul>
  <li> Do czego s³u¿± i jak dzia³aj± funkcje <tt>Pthread_cond_wait</tt> i <tt>Pthread_cond_signal</tt> (+ wyja¶nij argumenty)?
  <li> Co to s± zmienne warunkowe?
  <li> Do czego s³u¿y zmienna <tt>nready.nready</tt> (+ wyja¶nij jej zastosowanie zarówno od strony producenta i konsumenta)?
  <li> Odpowiedz w raporcie:<br/>
        Czy jest jaka¶ korzy¶æ z wykorzystania zmiennej warunkowej w programie <tt>prodcons5</tt> w porównaniu z programem <tt>prodcons3</tt>?<br/>
        Je¶li tak, to na czym ona polega?
  <li> Kiedy konsument mo¿e sprawdzaæ elementy tablicy <tt>buff</tt> (+ opisz dlaczego s± wywo³ywane i jakie s± skutki tych wywo³añ dla funkcji <tt>Pthread_cond_wait</tt>, <tt>Pthread_cond_signal</tt>, <tt>Pthread_mutex_lock</tt> i <tt>Pthread_mutex_unlock</tt>)?
  </ul>
</ul>
<p/>

<p/>

<li> Prodcons6
<ul>
<li> Zapoznaj siê z programem ¼ród³owym <tt>prodcons6.c</tt>.
<li> Do czego s³u¿± i jak s± wykorzystywane pola struktur <tt>nready</tt> i <tt>put</tt> (+ wyja¶nij do czego i w jakim celu u¿ywaj± ich producenci i konsument)?
<li> Odpowiedz w raporcie:<br/>
Opisz mechanizm odpowiedzialny za krótszy czas wykonywania siê (przyjmniej teoretycznie) programu <tt>prodcons6</tt> wzglêdem programu <tt>prodcons5</tt>.
</ul>
<p/>

<p/>

</ol>
<p/>

<p/>

</body>
</html>
